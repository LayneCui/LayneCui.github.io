<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="河工大12级，就职于安邦电商。爱生活，爱coding。">
<meta property="og:type" content="website">
<meta property="og:title" content="LayneCui's Blog">
<meta property="og:url" content="http://mp.weixin.qq.com/s?__biz=MzI2MzU0MTgzNw==&mid=100000011&idx=1&sn=6abf17b44b49de680c76ec808719202f&chksm=6abb04295dcc8d3f88b62e54c44b02d5836c85c7a2a760ce999834579a5923d0d5b14c5ecf75&scene=18#rd/index.html">
<meta property="og:site_name" content="LayneCui's Blog">
<meta property="og:description" content="河工大12级，就职于安邦电商。爱生活，爱coding。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LayneCui's Blog">
<meta name="twitter:description" content="河工大12级，就职于安邦电商。爱生活，爱coding。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://mp.weixin.qq.com/s?__biz=MzI2MzU0MTgzNw==&mid=100000011&idx=1&sn=6abf17b44b49de680c76ec808719202f&chksm=6abb04295dcc8d3f88b62e54c44b02d5836c85c7a2a760ce999834579a5923d0d5b14c5ecf75&scene=18#rd/"/>





  <title>LayneCui's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LayneCui's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">人懒爱玩，不易相处</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://mp.weixin.qq.com/s?__biz=MzI2MzU0MTgzNw==&mid=100000011&idx=1&sn=6abf17b44b49de680c76ec808719202f&chksm=6abb04295dcc8d3f88b62e54c44b02d5836c85c7a2a760ce999834579a5923d0d5b14c5ecf75&scene=18#rd/2019/05/23/RxJava用法及实战/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LayneCui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LayneCui's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/23/RxJava用法及实战/" itemprop="url">RxJava用法及实战</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-23T10:17:20+08:00">
                2019-05-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h3 id="核心思想："><a href="#核心思想：" class="headerlink" title="核心思想："></a><strong>核心思想：</strong></h3><p>RxJava学习和使用最重要的是掌握它的核心思想，它在 github 主页的介绍是：</p>
<blockquote>
<p>“a library for composing asynchronous and event-based programs using observable sequences for the Java VM”</p>
</blockquote>
<p>我理解是：一个运行在 Java 虚拟机上的可序列观察组合、异步和基于事件的库。所以能推导 Rx 定义为：序列观察组合异步事件。<br>我们能得到几个关键词：</p>
<ul>
<li>序列：对顺序敏感（事件发送）</li>
<li>观察：响应式编程</li>
<li>组合：可处理多个事件</li>
<li>异步：可调度线程</li>
<li>事件：可以理解为起点发送的事件，也可以理解为每个中间环节的操作</li>
</ul>
<p>根据使用经验来总结其核心思想：在起点注册观察后分发一个事件，流式操作中间步骤，终点消费事件解除观察。</p>
<p>因为它的操作符很多，遍历学习操作符性价比很小，我们根据其核心思想，以输出的方式来学习 RxJava。</p>
<h3 id="普通应用："><a href="#普通应用：" class="headerlink" title="普通应用："></a><strong>普通应用：</strong></h3><p>业务要求1：有一个图片url地址，下载图片并且将图片显示在 ImageView。</p>
<p>思路：事件为下载并且展示图片到 ImageView，事件起点为分发（放置）一个 url 给下游中间步骤1（传送带），下游中间步骤1拿到的为String而步骤二设置图片显示需要的数据为 Bitmap，所以此步骤需要 Map 操作符来将url转换为 Bitmap并且应该 为异步操作，然后将 Bitmap分发给下游中间步骤 2，步骤 2 将 Bitmap更新到 ImageView，消费掉事件，事件结束。</p>
<p>流程图为：<br><img src="https://upload-images.jianshu.io/upload_images/1386980-31c407bd122f2028.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>上代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 打印logcat日志的标签</span></div><div class="line">String TAG = DownloadActivity.class.getSimpleName();</div><div class="line"></div><div class="line"><span class="comment">// 网络图片的链接地址</span></div><div class="line">String PATH = <span class="string">"http://pic1.win4000.com/wallpaper/c/53cdd1f7c1f21.jpg"</span>;</div><div class="line"></div><div class="line"><span class="comment">// 弹出加载框</span></div><div class="line">ProgressDialog progressDialog;</div><div class="line"></div><div class="line">Observable.just(PATH)  <span class="comment">// 内部会分发  PATH Stirng // TODO 第二步 </span></div><div class="line">  <span class="comment">// TODO 第二步      </span></div><div class="line">  		.map(<span class="keyword">new</span> Function&lt;String, Bitmap&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Bitmap <span class="title">apply</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                URL url = <span class="keyword">new</span> URL(PATH);</div><div class="line">                HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection();</div><div class="line">                httpURLConnection.setConnectTimeout(<span class="number">5000</span>);</div><div class="line">                <span class="keyword">int</span> responseCode = httpURLConnection.getResponseCode(); <span class="comment">// 才开始 request</span></div><div class="line">                <span class="keyword">if</span> (responseCode == HttpURLConnection.HTTP_OK) &#123;</div><div class="line">                    InputStream inputStream = httpURLConnection.getInputStream();</div><div class="line">                    Bitmap bitmap = BitmapFactory.decodeStream(inputStream);</div><div class="line">                    <span class="keyword">return</span> bitmap;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">        <span class="comment">// 日志记录</span></div><div class="line">        .map(<span class="keyword">new</span> Function&lt;Bitmap, Bitmap&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Bitmap <span class="title">apply</span><span class="params">(Bitmap bitmap)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                Log.d(TAG, <span class="string">"apply: 是这个时候下载了图片啊:"</span> + System.currentTimeMillis());</div><div class="line">                <span class="keyword">return</span> bitmap;</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">        .subscribeOn(Schedulers.io())     <span class="comment">// 给上面代码分配异步线程</span></div><div class="line">        .observeOn(AndroidSchedulers.mainThread()) <span class="comment">// 切换主线程</span></div><div class="line">        <span class="comment">// 订阅 起点 和 终点 订阅起来</span></div><div class="line">        .subscribe(</div><div class="line">                <span class="comment">// 终点</span></div><div class="line">                <span class="keyword">new</span> Observer&lt;Bitmap&gt;() &#123;</div><div class="line">                    <span class="comment">// 订阅开始</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</div><div class="line">                        <span class="comment">// 预备 开始 要分发 创建并展示 loading</span></div><div class="line">                        <span class="comment">// TODO 第一步</span></div><div class="line">                        progressDialog = <span class="keyword">new</span> ProgressDialog(DownloadActivity.<span class="keyword">this</span>);</div><div class="line">                        progressDialog.setTitle(<span class="string">"download run"</span>);</div><div class="line">                        progressDialog.show();</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="comment">// TODO 第四步</span></div><div class="line">                    <span class="comment">// 消费事件</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">                        image.setImageBitmap(bitmap);</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="comment">// 错误事件</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">// TODO 第五步</span></div><div class="line">                    <span class="comment">// 完成事件</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (progressDialog != <span class="keyword">null</span>)</div><div class="line">                            progressDialog.dismiss();</div><div class="line">                    &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>实现完上边需求，产品小姐姐说需要一个加水印的功能，没问题，我们就在上边代码基础上来做改造。</p>
<p>思路：在上述步骤1，拿到 Bitmap 后然后我们将步骤2 改为为 Bitmap 添加水印，然后步骤3 来完成图片的展示和事件的消费。</p>
<p>修改后的流程图为：<br><img src="https://upload-images.jianshu.io/upload_images/1386980-90471cc97e0b1145.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>上代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 打印logcat日志的标签</span></div><div class="line">	String TAG = DownloadActivity.class.getSimpleName();</div><div class="line"></div><div class="line">  <span class="comment">// 网络图片的链接地址</span></div><div class="line">   String PATH = <span class="string">"http://pic1.win4000.com/wallpaper/c/53cdd1f7c1f21.jpg"</span>;</div><div class="line"></div><div class="line">  <span class="comment">// 弹出加载框</span></div><div class="line">  ProgressDialog progressDialog;</div><div class="line"></div><div class="line">Observable.just(PATH)  <span class="comment">// 内部会分发  PATH Stirng // TODO 第二步 </span></div><div class="line">  <span class="comment">// TODO 第二步      </span></div><div class="line">  				.map(<span class="keyword">new</span> Function&lt;String, Bitmap&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Bitmap <span class="title">apply</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                URL url = <span class="keyword">new</span> URL(PATH);</div><div class="line">                HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection();</div><div class="line">                httpURLConnection.setConnectTimeout(<span class="number">5000</span>);</div><div class="line">                <span class="keyword">int</span> responseCode = httpURLConnection.getResponseCode(); <span class="comment">// 才开始 request</span></div><div class="line">                <span class="keyword">if</span> (responseCode == HttpURLConnection.HTTP_OK) &#123;</div><div class="line">                    InputStream inputStream = httpURLConnection.getInputStream();</div><div class="line">                    Bitmap bitmap = BitmapFactory.decodeStream(inputStream);</div><div class="line">                    <span class="keyword">return</span> bitmap;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">  			<span class="comment">// 此处为新增水印操作代码</span></div><div class="line">        .map(<span class="keyword">new</span> Function&lt;Bitmap, Bitmap&gt;() &#123;</div><div class="line">                  <span class="meta">@Override</span></div><div class="line">                  <span class="function"><span class="keyword">public</span> Bitmap <span class="title">apply</span><span class="params">(Bitmap bitmap)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                      Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">                      paint.setTextSize(<span class="number">88</span>);</div><div class="line">                      paint.setColor(Color.RED);</div><div class="line">                      <span class="keyword">return</span> drawTextToBitmap(bitmap, <span class="string">"产品要得水印"</span>,paint, <span class="number">88</span> , <span class="number">88</span>);</div><div class="line">                  &#125;</div><div class="line">              &#125;)</div><div class="line">  </div><div class="line">        <span class="comment">// 日志记录</span></div><div class="line">        .map(<span class="keyword">new</span> Function&lt;Bitmap, Bitmap&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Bitmap <span class="title">apply</span><span class="params">(Bitmap bitmap)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                Log.d(TAG, <span class="string">"apply: 是这个时候下载了图片啊:"</span> + System.currentTimeMillis());</div><div class="line">                <span class="keyword">return</span> bitmap;</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">        .subscribeOn(Schedulers.io())     <span class="comment">// 给上面代码分配异步线程</span></div><div class="line">        .observeOn(AndroidSchedulers.mainThread()) <span class="comment">// 切换主线程</span></div><div class="line">        <span class="comment">// 订阅 起点 和 终点 订阅起来</span></div><div class="line">        .subscribe(</div><div class="line">                <span class="comment">// 终点</span></div><div class="line">                <span class="keyword">new</span> Observer&lt;Bitmap&gt;() &#123;</div><div class="line">                    <span class="comment">// 订阅开始</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</div><div class="line">                        <span class="comment">// 预备 开始 要分发 创建并展示 loading</span></div><div class="line">                        <span class="comment">// TODO 第一步</span></div><div class="line">                        progressDialog = <span class="keyword">new</span> ProgressDialog(DownloadActivity.<span class="keyword">this</span>);</div><div class="line">                        progressDialog.setTitle(<span class="string">"download run"</span>);</div><div class="line">                        progressDialog.show();</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="comment">// TODO 第四步</span></div><div class="line">                    <span class="comment">// 消费事件</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">                        image.setImageBitmap(bitmap);</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="comment">// 错误事件</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">// TODO 第五步</span></div><div class="line">                    <span class="comment">// 完成事件</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (progressDialog != <span class="keyword">null</span>)</div><div class="line">                            progressDialog.dismiss();</div><div class="line">                    &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 图片上绘制文字 加水印</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> Bitmap <span class="title">drawTextToBitmap</span><span class="params">(Bitmap bitmap, String text, Paint paint, <span class="keyword">int</span> paddingLeft, <span class="keyword">int</span> paddingTop)</span> </span>&#123;</div><div class="line">        Bitmap.Config bitmapConfig = bitmap.getConfig();</div><div class="line"></div><div class="line">        paint.setDither(<span class="keyword">true</span>); <span class="comment">// 获取跟清晰的图像采样</span></div><div class="line">        paint.setFilterBitmap(<span class="keyword">true</span>);<span class="comment">// 过滤一些</span></div><div class="line">        <span class="keyword">if</span> (bitmapConfig == <span class="keyword">null</span>) &#123;</div><div class="line">            bitmapConfig = Bitmap.Config.ARGB_8888;</div><div class="line">        &#125;</div><div class="line">        bitmap = bitmap.copy(bitmapConfig, <span class="keyword">true</span>);</div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(bitmap);</div><div class="line"></div><div class="line">        canvas.drawText(text, paddingLeft, paddingTop, paint);</div><div class="line">        <span class="keyword">return</span> bitmap;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="防抖："><a href="#防抖：" class="headerlink" title="防抖："></a><strong>防抖：</strong></h3><p>防抖的意思就是说规定时间内接收到多次事件只触发一次。放置恶意轰炸，或者重复触发问题。</p>
<p>业务需求：如下图，两秒内项目按钮点击只完成一次获取所有项目分类，并且根据项目 id 获取所有项目下的所有列表数据。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1386980-2b30b52ea59cf499.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>一般思路：利用 RxBinding 处理防抖动，然后步骤1，网络获取所有项目数据，数据类型为[ProjectBean,ProjectBean,ProjectBean,ProjectBean,ProjectBean…],步骤 2，根据步骤 1 获取的ProjectBeanList 遍历，分别根据每个 ProjectBean id 去获取项目列表数据。步骤 3，分别获取每个项目的列表数据 [ProjectItem,ProjectItem,ProjectItem,ProjectItem,ProjectItem..]去更新 UI消费掉该事件。</p>
<p>流程图如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1386980-96d81fc4c7c20fb8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>上代码：（此处为伪代码实现）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 注意：（项目分类）查询的id，通过此id再去查询(项目列表数据)</span></div><div class="line">        <span class="comment">// 对那个控件防抖动？</span></div><div class="line">        Button bt_anti_shake = findViewById(R.id.bt_anti_shake);</div><div class="line">        RxView.clicks(bt_anti_shake)</div><div class="line">                .throttleFirst(<span class="number">2000</span>, TimeUnit.MILLISECONDS) <span class="comment">// 2秒钟之内 响应你一次</span></div><div class="line">                .subscribe(<span class="keyword">new</span> Consumer&lt;Object&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Object o)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        api.getProject() <span class="comment">// 查询主数据</span></div><div class="line">                        .compose(RxUtils.rxud()) <span class="comment">//线程切换封装</span></div><div class="line">                        .subscribe(<span class="keyword">new</span> Consumer&lt;ProjectBean&gt;() &#123;</div><div class="line">                            <span class="meta">@Override</span></div><div class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ProjectBean projectBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                                <span class="keyword">for</span> (ProjectBean.DataBean dataBean : projectBean.getData()) &#123; <span class="comment">// 10</span></div><div class="line">                                    <span class="comment">// 查询item数据</span></div><div class="line">                                    api.getProjectItem(<span class="number">1</span>, dataBean.getId())</div><div class="line">                                    .compose(RxUtils.rxud())</div><div class="line">                                    .subscribe(<span class="keyword">new</span> Consumer&lt;ProjectItem&gt;() &#123;</div><div class="line">                                        <span class="meta">@Override</span></div><div class="line">                                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ProjectItem projectItem)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                                            Log.d(TAG, <span class="string">"accept: "</span> + projectItem); <span class="comment">// 可以UI操作</span></div><div class="line">                                        &#125;</div><div class="line">                                    &#125;);</div><div class="line">                                &#125;</div><div class="line">                            &#125;</div><div class="line">                        &#125;);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure>
<h3 id="网络嵌套："><a href="#网络嵌套：" class="headerlink" title="网络嵌套："></a><strong>网络嵌套：</strong></h3><p>上边防抖代码可读性很差，why？因为上边代码有两次嵌套缩进，第一次为实现防抖动，回调缩进了一次，项目列表数据获取也在主数据获取的回调嵌套中。</p>
<p>解决迷之嵌套问题，我们需要了解 RxJava 的另一个操作符：</p>
<p>flatmap:可以将一个观察集合数据的观察者展开为多个观察一条数据的观察者。这也是他和 map 的最主要区别，当集合中只有一条数据时，它的作用将和 map 一样。回顾上边普通应用的需求实现都是从头到尾一个观察者，观察着一条数据向下游流动。</p>
<p>改造版代码：（同样为伪代码）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 对那个控件防抖动？</span></div><div class="line">        Button bt_anti_shake = findViewById(R.id.bt_anti_shake);</div><div class="line"></div><div class="line">        RxView.clicks(bt_anti_shake)</div><div class="line">                .throttleFirst(<span class="number">2000</span>, TimeUnit.MILLISECONDS) <span class="comment">// 2秒钟之内 响应你一次</span></div><div class="line">                <span class="comment">// 我只给下面 切换 异步</span></div><div class="line">                .observeOn(Schedulers.io())</div><div class="line">                .flatMap(<span class="keyword">new</span> Function&lt;Object, ObservableSource&lt;ProjectBean&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> ObservableSource&lt;ProjectBean&gt; <span class="title">apply</span><span class="params">(Object o)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="keyword">return</span> api.getProject(); <span class="comment">// 主数据</span></div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .flatMap(<span class="keyword">new</span> Function&lt;ProjectBean, ObservableSource&lt;ProjectBean.DataBean&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> ObservableSource&lt;ProjectBean.DataBean&gt; apply(ProjectBean projectBean) <span class="keyword">throws</span> Exception &#123;</div><div class="line">                        <span class="keyword">return</span> Observable.fromIterable(projectBean.getData()); <span class="comment">// 注册多个观察者</span></div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .flatMap(<span class="keyword">new</span> Function&lt;ProjectBean.DataBean, ObservableSource&lt;ProjectItem&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> ObservableSource&lt;ProjectItem&gt; <span class="title">apply</span><span class="params">(ProjectBean.DataBean dataBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="keyword">return</span> api.getProjectItem(<span class="number">1</span>, dataBean.getId());</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .observeOn(AndroidSchedulers.mainThread()) <span class="comment">// 给下面切换 主线程</span></div><div class="line">                .subscribe(<span class="keyword">new</span> Consumer&lt;ProjectItem&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ProjectItem projectItem)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="comment">// 如果我要更新UI  会报错2  不会报错1</span></div><div class="line">                        Log.d(TAG, <span class="string">"accept: "</span> + projectItem);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure>
<h3 id="连续操作："><a href="#连续操作：" class="headerlink" title="连续操作："></a><strong>连续操作：</strong></h3><p>上边需求发现没？有一个共同规律，就是都是一个事件开始，然后事件结束。如果实现一个时间开始，一个时间结束，然后再次开启一个事件，然后再次结束第二个事件怎么办？是和上述代码并列，再次创建一个观察者？NO！看下边操作符。</p>
<p>doNoNext：可以用于，多个连续事件，执行过程中，事件都需要按顺序消费掉前边事件然后继续执行后边事件。</p>
<p>业务需求：用户注册完成后更新UI 跳转登录页面并且自动登录后跳转首页。</p>
<p>实现思路：用户点击 reigstBtn获取注册结果，拿到注册结果 UI 线程去跳转登录页面，然后工作线程去根据 reigstResponse 去请求登录数据，拿到登录信息去跳转首页，消费掉这个事件。注意：此时消费掉的事件并非最初事件。</p>
<p>业务流程比较简单，直接代码实现：（伪代码）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">         * 一行代码 实现需求</div><div class="line">         * 需求：</div><div class="line">         *   还有弹出加载</div><div class="line">         *  * 1.请求服务器注册操作</div><div class="line">         *  * 2.注册完成之后，更新注册UI</div><div class="line">         *  * 3.马上去登录服务器操作</div><div class="line">         *  * 4.登录完成之后，更新登录的UI</div><div class="line">         */</div><div class="line">        MyRetrofit.createRetrofit().create(IReqeustNetwor.class)</div><div class="line">                .registerAction(<span class="keyword">new</span> RegisterRequest()) <span class="comment">// todo 1.请求服务器注册操作   // todo 2</span></div><div class="line">                .subscribeOn(Schedulers.io()) <span class="comment">// 给上面 异步</span></div><div class="line">                .observeOn(AndroidSchedulers.mainThread()) <span class="comment">// 给下面分配主线程</span></div><div class="line">                .doOnNext(<span class="keyword">new</span> Consumer&lt;RegisterResponse&gt;() &#123; <span class="comment">// todo 3</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(RegisterResponse registerResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="comment">// todo 2.注册完成之后，更新注册UI</span></div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="comment">// todo 3.马上去登录服务器操作</span></div><div class="line">                .observeOn(Schedulers.io()) <span class="comment">// 给下面分配了异步线程</span></div><div class="line">                .flatMap(<span class="keyword">new</span> Function&lt;RegisterResponse, ObservableSource&lt;LoginResponse&gt;&gt;() &#123; <span class="comment">// todo 4</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> ObservableSource&lt;LoginResponse&gt; <span class="title">apply</span><span class="params">(RegisterResponse registerResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        Observable&lt;LoginResponse&gt; loginResponseObservable = MyRetrofit.createRetrofit().create(IReqeustNetwor.class)</div><div class="line">                                .loginAction(<span class="keyword">new</span> LoginReqeust());</div><div class="line">                        <span class="keyword">return</span> loginResponseObservable;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .observeOn(AndroidSchedulers.mainThread()) <span class="comment">// 给下面 执行主线程</span></div><div class="line">                .subscribe(<span class="keyword">new</span> Observer&lt;LoginResponse&gt;() &#123;</div><div class="line">                    <span class="comment">// 一定是主线程，为什么，因为 subscribe 马上调用onSubscribe</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</div><div class="line">                        <span class="comment">// TODO 1</span></div><div class="line">                        progressDialog = <span class="keyword">new</span> ProgressDialog(RequestActivity.<span class="keyword">this</span>);</div><div class="line">                        progressDialog.show();</div><div class="line">                        <span class="comment">// UI 操作</span></div><div class="line">                        disposable = d;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(LoginResponse loginResponse)</span> </span>&#123; <span class="comment">// todo 5</span></div><div class="line">                        <span class="comment">// TODO 4.登录完成之后，更新登录的UI</span></div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line"></div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="comment">// todo 6</span></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</div><div class="line">                        <span class="comment">// over</span></div><div class="line">                        <span class="keyword">if</span> (progressDialog != <span class="keyword">null</span>) &#123;</div><div class="line">                            progressDialog.dismiss();</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure>
<p>􏱥􏰎</p>
<h3 id="并行操作："><a href="#并行操作：" class="headerlink" title="并行操作："></a><strong>并行操作：</strong></h3><p>􏲩􏲀􏰟􏰠􏲪􏲫􏰖􏲀􏲊􏲬􏲝􏲅􏰶再有一个例子，右下边需求：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1386980-ce490e1d89a67cda.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Map&lt;String, String&gt; map = CZController.paramHelp.getBasicParam();</div><div class="line">        map.put(<span class="string">"catalogId"</span>, catalogId);</div><div class="line">        map.put(<span class="string">"courseId"</span>, courseId);</div><div class="line"></div><div class="line"></div><div class="line">        Observable&lt;CZResult&lt;String&gt;&gt; obLiveData =</div><div class="line">                ApiWrapper.getService().getLiveRoomV2(map)</div><div class="line">                        .subscribeOn(Schedulers.io());</div><div class="line">        Observable&lt;CZResult&lt;String&gt;&gt; obUserInfo =</div><div class="line">                ApiWrapper.getService().getLiveEmployeeInfo(map)</div><div class="line">                        .subscribeOn(Schedulers.io());</div><div class="line"></div><div class="line">        Observable.merge(obLiveData, obUserInfo)</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(<span class="keyword">new</span> CZSubscriberD&lt;CZResult&lt;String&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCZNext</span><span class="params">(String json)</span> </span>&#123;</div><div class="line">                      </div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="递归："><a href="#递归：" class="headerlink" title="递归："></a><strong>递归：</strong></h3><p>还是一个需求来看，扫描某个路径下的所有文件，找出格式为 .doc 的文件并输出路径。</p>
<p>直接看代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* 获取某文件夹下所有 doc 格式的文件路径</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getFiles</span><span class="params">(File file)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(!file.isDirectory()) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        Observable.just(file)</div><div class="line">                .observeOn(Schedulers.io())</div><div class="line">                .map(<span class="keyword">new</span> Function&lt;File, List&lt;File&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> List&lt;File&gt; <span class="title">apply</span><span class="params">(File file)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="keyword">return</span> Arrays.asList(file.listFiles());</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .flatMap(<span class="keyword">new</span> Function&lt;List&lt;File&gt;, ObservableSource&lt;File&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> ObservableSource&lt;File&gt; <span class="title">apply</span><span class="params">(List&lt;File&gt; files)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="keyword">return</span> Observable.fromIterable(files);</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(<span class="keyword">new</span> Consumer&lt;File&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(File file)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="comment">//TODO 判断 file 类型，如果是文件夹则递归，如果是需要的格式则继续，否则结束</span></div><div class="line">                        <span class="keyword">if</span> (file.isDirectory()) &#123;</div><div class="line">                            getFiles(file);</div><div class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (file.getName().endsWith(<span class="string">".doc"</span>)) &#123;</div><div class="line">                            Log.d(<span class="string">"Tag1"</span>, <span class="string">"path:"</span> + file.getPath());</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            Log.d(<span class="string">"Tag1"</span>, <span class="string">"其他类型文件"</span>);</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>哈哈哈，咋样，如果你真拿上边代码去应用，就会发现一个问题，卡的一笔。</p>
<p>为什么呢，flatmap 就会创建 n 个 Observable，然后外层递归更可怕 n 的 n 次方个Observable,所以递归中最好都不要有对象的创建，哈哈哈。</p>
<p>看一下下边代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by droidwolf on 2017/11/14.</div><div class="line"> * https://my.oschina.net/droidwolf</div><div class="line"> * 转载请注明</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileTreeWalker</span> <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">File</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> ArrayDeque&lt;File&gt; mDirectories =<span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> ArrayDeque&lt;File&gt; mFiles = <span class="keyword">null</span>;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> FileTreeWalker <span class="title">walk</span><span class="params">(File path)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mDirectories != <span class="keyword">null</span> &amp;&amp; !mDirectories.isEmpty()) &#123;</div><div class="line">            mDirectories.clear();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (mFiles != <span class="keyword">null</span> &amp;&amp; !mFiles.isEmpty()) &#123;</div><div class="line">            mFiles.clear();</div><div class="line">        &#125;</div><div class="line">        walkDir(path);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">walkDir</span><span class="params">(File path)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (path == <span class="keyword">null</span> || !path.exists() || !path.isDirectory()) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">final</span> File[] files = path.listFiles();</div><div class="line">        <span class="keyword">if</span> (files == <span class="keyword">null</span> || files.length == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(mDirectories==<span class="keyword">null</span>) mDirectories = <span class="keyword">new</span> ArrayDeque&lt;File&gt;(<span class="number">256</span>);</div><div class="line">        <span class="keyword">if</span>(mFiles==<span class="keyword">null</span>) mFiles = <span class="keyword">new</span> ArrayDeque&lt;File&gt;(<span class="number">512</span>);</div><div class="line"> </div><div class="line">        <span class="keyword">for</span> (File f : files) &#123;</div><div class="line">            <span class="keyword">if</span> (f.isDirectory()) &#123;</div><div class="line">                mDirectories.push(f);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                mFiles.addLast(f);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;File&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mIterator;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Iterator&lt;File&gt; mIterator=<span class="keyword">new</span> Iterator&lt;File&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> (mFiles!=<span class="keyword">null</span> &amp;&amp;!mFiles.isEmpty()) || (mDirectories!=<span class="keyword">null</span>&amp;&amp; !mDirectories.isEmpty());</div><div class="line">        &#125;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> File <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (mFiles != <span class="keyword">null</span> &amp;&amp; !mFiles.isEmpty()) &#123;</div><div class="line">                <span class="keyword">final</span> File f = mFiles.pollFirst();</div><div class="line"> </div><div class="line">                <span class="keyword">return</span> f;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mDirectories != <span class="keyword">null</span> &amp;&amp; !mDirectories.isEmpty()) &#123;</div><div class="line">                <span class="keyword">final</span> File dir = mDirectories.pop();</div><div class="line"> </div><div class="line">                walkDir(dir);</div><div class="line">                <span class="keyword">return</span> dir;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// rxjava调用FileTreeWalker </span></div><div class="line">     Observable.fromIterable(<span class="keyword">new</span> FileTreeWalker().walk(path))</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .filter(file -&gt; &#123;</div><div class="line">                    <span class="comment">//。。。</span></div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                &#125;)</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(fileNext -&gt; &#123;</div><div class="line">					<span class="comment">//。。。</span></div><div class="line">                &#125;);</div><div class="line"><span class="comment">//当然也可以在java8中使用FileTreeWalker</span></div><div class="line"></div><div class="line">StreamSupport.stream(Spliterators.spliteratorUnknownSize(<span class="keyword">new</span> FileTreeWalker().walk(<span class="keyword">new</span> File(<span class="string">"C:\\"</span>)).iterator(),Spliterator.NONNULL),<span class="keyword">true</span> )</div><div class="line">.forEach(file-&gt;&#123;</div><div class="line">	<span class="keyword">if</span>(file.isDirectory()) &#123;</div><div class="line">		System.out.println(file.getName());</div><div class="line">	&#125;<span class="keyword">else</span> &#123;</div><div class="line">		System.out.println(<span class="string">"\t"</span>+file.getName());</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a><strong>小结</strong></h3><p>带着本文第一节对“核心思想”的理解，来思考一下这几个业务实现。发现每个业务都重点关注事件的开始和结束也就是事件的传入数据类型和最终消费事件需要的数据类型，中间步骤的所有转换都有操作符去支持我们。</p>
<p>上边图片下载问题可以举个相似栗子：小明肚子饿了，想吃东西利用核心思想来实现一下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1386980-9c713b0e1903eea0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>此事件完整实现需要先确定事件开始（大脑饿了信号类型），和事件结束（食物类型）中间具体需要步骤都可以有操作符来实现。</p>
<p>网络嵌套需求举个相似栗子：小明饿了，想吃 10 种东西：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1386980-1434a016ee277a95.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>连续操作需求举一个相似栗子：小明饿了，吃完饭然后去上学。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1386980-1d572df8c5f3a1ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>关注开始与结束</p>
<h3 id="操作符汇总："><a href="#操作符汇总：" class="headerlink" title="操作符汇总："></a><strong>操作符汇总：</strong></h3><p><img src="https://upload-images.jianshu.io/upload_images/1386980-7a741cb044032189.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://mp.weixin.qq.com/s?__biz=MzI2MzU0MTgzNw==&mid=100000011&idx=1&sn=6abf17b44b49de680c76ec808719202f&chksm=6abb04295dcc8d3f88b62e54c44b02d5836c85c7a2a760ce999834579a5923d0d5b14c5ecf75&scene=18#rd/2018/07/22/事件分发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LayneCui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LayneCui's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/22/事件分发/" itemprop="url">View 事件分发</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-22T19:10:30+08:00">
                2018-07-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h3 id="事件的种类"><a href="#事件的种类" class="headerlink" title="事件的种类"></a>事件的种类</h3><table>
<thead>
<tr>
<th style="text-align:center">手势类型</th>
<th style="text-align:center">事件名称</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">按下</td>
<td style="text-align:center">MotionEvent.ACTION_DOWN</td>
<td style="text-align:center">一切事件的起点、可以有多个</td>
</tr>
<tr>
<td style="text-align:center">移动</td>
<td style="text-align:center">MotionEvent.ACTION_MOVE</td>
<td style="text-align:center">手指移动时持续触发</td>
</tr>
<tr>
<td style="text-align:center">抬起</td>
<td style="text-align:center">MotionEvent.ACTION_UP</td>
<td style="text-align:center">手指抬起，事件结束</td>
</tr>
<tr>
<td style="text-align:center">取消</td>
<td style="text-align:center">MotionEvent.ACTION_CANCEL</td>
<td style="text-align:center">事件取消，比如ViewGroup抢夺事件</td>
</tr>
</tbody>
</table>
<h3 id="事件的传递"><a href="#事件的传递" class="headerlink" title="事件的传递"></a>事件的传递</h3><p>在手指接触屏幕那一刻，由屏幕到 Native 层，再由 Native 传到 Activity 的 <code>dispatchTouchEvent();</code> 我们来看一下Activity 的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * Called to process touch screen events.  You can override this to</div><div class="line">     * intercept all touch screen events before they are dispatched to the</div><div class="line">     * window.  Be sure to call this implementation for touch screen events</div><div class="line">     * that should be handled normally.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> ev The touch screen event.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> boolean Return true if this event was consumed.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</div><div class="line">          <span class="comment">// activity无论分发按键事件、触摸事件或者轨迹球事件都会调用Activity#onUserInteraction()</span></div><div class="line">          <span class="comment">// 重写该方法可知道用户用某种方式和你正在运行的activity交互</span></div><div class="line">            onUserInteraction();</div><div class="line">        &#125;</div><div class="line">            <span class="comment">// 如果 getWindow().superDispatchTouchEvent(ev) 返回为 true 则说明事件被 Activity</span></div><div class="line">            <span class="comment">// 子布局消费掉，事件被处理则返回 true</span></div><div class="line">        <span class="keyword">if</span> (getWindow().superDispatchTouchEvent(ev)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">            <span class="comment">// 如果 Activity 子布局没有消费该事件，则事件由 Activity 处理 </span></div><div class="line">        <span class="keyword">return</span> onTouchEvent(ev);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>为方便查看，我在代码中加了注释，因为我们关心的是 View 的事件分发，所以我们关心的应该是<code>getWindow().superDispatchTouchEvent(ev)</code>，分发的过程。跟进去我们发现 <code>superDispatchTouchEvent(ev)</code> 在 Window 中是一个抽象方法，在 Android 中 PhoneWindow 是 Window 的唯一实现子类。看一下 <code>PhoneWindow#superDispatchTouchEvent(MotionEvent event)</code> :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">superDispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mDecor.superDispatchTouchEvent(event);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>发现，PhoneWindow 去调用了 DecorView 的 <code>superDispatchTouchEvent(MotionEvent event)</code>，再来看一下 <code>DecorView#superDispatchTouchEvent(MotionEvent event)</code> :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">superDispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>发现 DecorView 调用了父亲的 <code>dispatchTouchEvent(event);</code> ，DecorView 继承自 FrameLayout，看一下FrameLayout 发现他并没有实现该方法，所以，DecorView应该调用的是 Fragment 的父亲 ViewGroup 的<code>dispatchTouchEvent(MotionEvent event)</code> ，所以，事件就从屏幕最终传输到 View 和 ViewGroup 来分发和处理大概流程如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1386980-402acf89ae69fd5d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="关键方法"><a href="#关键方法" class="headerlink" title="关键方法:"></a>关键方法:</h3><h4 id="ViewGroup-dispatchTouchEvent"><a href="#ViewGroup-dispatchTouchEvent" class="headerlink" title="ViewGroup # dispatchTouchEvent"></a>ViewGroup # dispatchTouchEvent</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">boolean</span> handled = <span class="keyword">false</span>;</div><div class="line">    <span class="comment">// 触摸事件安全检查，一般都没问题</span></div><div class="line">    <span class="keyword">if</span> (onFilterTouchEventForSecurity(ev)) &#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> action = ev.getAction();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = action &amp; MotionEvent.ACTION_MASK;</div><div class="line"></div><div class="line">        <span class="comment">// Handle an initial down.</span></div><div class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</div><div class="line">            <span class="comment">// Throw away all previous state when starting a new touch gesture.</span></div><div class="line">            <span class="comment">// The framework may have dropped the up or cancel event for the previous gesture</span></div><div class="line">            <span class="comment">// due to an app switch, ANR, or some other state change.</span></div><div class="line">            cancelAndClearTouchTargets(ev);</div><div class="line">            resetTouchState();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Check for interception.</span></div><div class="line">        <span class="comment">// 是否拦截事件标志（重要）</span></div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> intercepted;</div><div class="line">        <span class="comment">// 如果是按下事件（新的触摸动作），或者已经存在处理事件的子View</span></div><div class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</div><div class="line">                || mFirstTouchTarget != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// 检查是否不允许拦截，由子 view requestDisallowInterceptTouchEvent(true)设置</span></div><div class="line">            <span class="comment">// 相当于子 view 的尚方宝剑</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (!disallowIntercept) &#123;</div><div class="line">                <span class="comment">// 允许拦截，该 viewgroup 去尝试拦截</span></div><div class="line">                intercepted = onInterceptTouchEvent(ev);</div><div class="line">                ev.setAction(action); <span class="comment">// restore action in case it was changed</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                intercepted = <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// There are no touch targets and this action is not an initial down</span></div><div class="line">            <span class="comment">// so this view group continues to intercept touches.</span></div><div class="line">            intercepted = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">      </div><div class="line">                    ...</div><div class="line">          </div><div class="line">        <span class="comment">// Check for cancelation.</span></div><div class="line">        <span class="comment">// 检查这个事件是否是取消事件</span></div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> canceled = resetCancelNextUpFlag(<span class="keyword">this</span>)</div><div class="line">                || actionMasked == MotionEvent.ACTION_CANCEL;</div><div class="line"></div><div class="line">        <span class="comment">// Update list of touch targets for pointer down, if needed.</span></div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != <span class="number">0</span>;</div><div class="line">        TouchTarget newTouchTarget = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">boolean</span> alreadyDispatchedToNewTouchTarget = <span class="keyword">false</span>;</div><div class="line">        <span class="comment">// 如果不是取消事件，并且该事件没有被当前 view 拦截，进入分发流程</span></div><div class="line">        <span class="keyword">if</span> (!canceled &amp;&amp; !intercepted) &#123;</div><div class="line">          </div><div class="line">            ...</div><div class="line"></div><div class="line">            <span class="comment">// 如果是按下事件</span></div><div class="line">            <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</div><div class="line">                    || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</div><div class="line">                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</div><div class="line">                <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex(); <span class="comment">// always 0 for down</span></div><div class="line">                <span class="keyword">final</span> <span class="keyword">int</span> idBitsToAssign = split ? <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex)</div><div class="line">                        : TouchTarget.ALL_POINTER_IDS;</div><div class="line"></div><div class="line">                <span class="comment">// Clean up earlier touch targets for this pointer id in case they</span></div><div class="line">                <span class="comment">// have become out of sync.</span></div><div class="line">                removePointersFromTouchTargets(idBitsToAssign);</div><div class="line"></div><div class="line">                <span class="comment">// 该 view 的直接子 view/viewgroup数量（不包括孙 view）</span></div><div class="line">                <span class="keyword">final</span> <span class="keyword">int</span> childrenCount = mChildrenCount;</div><div class="line">                <span class="comment">// 还没有 view 接受按下事件，表示此事件为第一个按下事件</span></div><div class="line">                <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; childrenCount != <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> x = ev.getX(actionIndex);</div><div class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> y = ev.getY(actionIndex);</div><div class="line">                    <span class="comment">// Find a child that can receive the event.</span></div><div class="line">                    <span class="comment">// Scan children from front to back.</span></div><div class="line">                    <span class="comment">// 创建待遍历的view列表，按照虚拟 z 轴排序，排序将影响 view 接到事件的顺序</span></div><div class="line">                    <span class="keyword">final</span> ArrayList&lt;View&gt; preorderedList = buildTouchDispatchChildList();</div><div class="line">                    <span class="keyword">final</span> <span class="keyword">boolean</span> customOrder = preorderedList == <span class="keyword">null</span></div><div class="line">                            &amp;&amp; isChildrenDrawingOrderEnabled();</div><div class="line">                    <span class="keyword">final</span> View[] children = mChildren;</div><div class="line">                    <span class="comment">// 倒序遍历每个字 view/viewgroup</span></div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">                        <span class="comment">// 分别获取子 view 及其索引</span></div><div class="line">                        <span class="keyword">final</span> <span class="keyword">int</span> childIndex = getAndVerifyPreorderedIndex(</div><div class="line">                                childrenCount, i, customOrder);</div><div class="line">                        <span class="keyword">final</span> View child = getAndVerifyPreorderedView(</div><div class="line">                                preorderedList, children, childIndex);</div><div class="line"></div><div class="line">                        ...  </div><div class="line">                      </div><div class="line">                        <span class="comment">// 判断 view 可见性和是否存在动画，如果不可见或者因动画移出该区域</span></div><div class="line">                        <span class="comment">// 则跳过，继续遍历</span></div><div class="line">                        <span class="keyword">if</span> (!canViewReceivePointerEvents(child)</div><div class="line">                                || !isTransformedTouchPointInView(x, y, child, <span class="keyword">null</span>)) &#123;</div><div class="line">                            ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</div><div class="line">                            <span class="keyword">continue</span>;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="comment">// 链表中已经存在该view，说明该子view已经接收过按下（初始）</span></div><div class="line">                        <span class="comment">// 的触摸事件，说明这是一个多点触摸的情况，</span></div><div class="line">                        newTouchTarget = getTouchTarget(child);</div><div class="line">                        <span class="keyword">if</span> (newTouchTarget != <span class="keyword">null</span>) &#123;</div><div class="line">                            <span class="comment">// Child is already receiving touch within its bounds.</span></div><div class="line">                            <span class="comment">// Give it the new pointer in addition to the ones it is handling.</span></div><div class="line">                            newTouchTarget.pointerIdBits |= idBitsToAssign;</div><div class="line">                            <span class="keyword">break</span>;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        resetCancelNextUpFlag(child);</div><div class="line">                        <span class="comment">// 在此方法中对事件进行下发或者处理，如果为 true 说明事件被下层子 view </span></div><div class="line">                        <span class="comment">// 消费</span></div><div class="line">                        <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="keyword">false</span>, child, idBitsToAssign)) &#123;</div><div class="line">                            <span class="comment">// Child wants to receive touch within its bounds.</span></div><div class="line">                            <span class="comment">// 记录该事件消费时间和子 view 的下标</span></div><div class="line">                            mLastTouchDownTime = ev.getDownTime();</div><div class="line">                            <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) &#123;</div><div class="line">                                <span class="comment">// childIndex points into presorted list, find original index</span></div><div class="line">                                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; childrenCount; j++) &#123;</div><div class="line">                                    <span class="keyword">if</span> (children[childIndex] == mChildren[j]) &#123;</div><div class="line">                                        mLastTouchDownIndex = j;</div><div class="line">                                        <span class="keyword">break</span>;</div><div class="line">                                    &#125;</div><div class="line">                                &#125;</div><div class="line">                            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                                mLastTouchDownIndex = childIndex;</div><div class="line">                            &#125;</div><div class="line">                            mLastTouchDownX = ev.getX();</div><div class="line">                            mLastTouchDownY = ev.getY();</div><div class="line">                            <span class="comment">// 将接受按下事件的 view 加入到 TouchTarget 链表，                                                                                                // 同时记录此 view到 mFirstTouchTarget = target</span></div><div class="line">                            newTouchTarget = addTouchTarget(child, idBitsToAssign);</div><div class="line">                            alreadyDispatchedToNewTouchTarget = <span class="keyword">true</span>;</div><div class="line">                            <span class="comment">// 按下事件被消费，结束分发</span></div><div class="line">                            <span class="keyword">break</span>;</div><div class="line">                        &#125;</div><div class="line">                      ...</div><div class="line">                    &#125;   </div><div class="line">                    <span class="comment">// 将事件分发 view List 清空</span></div><div class="line">                    <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) preorderedList.clear();</div><div class="line">                &#125;<span class="comment">// 这里if (newTouchTarget == null &amp;&amp; childrenCount != 0) 判断结束点</span></div><div class="line">                                    <span class="comment">// 没有找到可以消费事件的子 view，事件回归到上次最近的 Down 事件</span></div><div class="line">                <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; mFirstTouchTarget != <span class="keyword">null</span>) &#123;</div><div class="line">                    <span class="comment">// Did not find a child to receive the event.</span></div><div class="line">                    <span class="comment">// Assign the pointer to the least recently added target.</span></div><div class="line">                    newTouchTarget = mFirstTouchTarget;</div><div class="line">                    <span class="keyword">while</span> (newTouchTarget.next != <span class="keyword">null</span>) &#123;</div><div class="line">                        newTouchTarget = newTouchTarget.next;</div><div class="line">                    &#125;</div><div class="line">                    newTouchTarget.pointerIdBits |= idBitsToAssign;</div><div class="line">                &#125;</div><div class="line">            &#125;<span class="comment">// down 事件</span></div><div class="line">        &#125; <span class="comment">// if (!canceled &amp;&amp; !intercepted) &#123;  分发事件结束</span></div><div class="line"></div><div class="line">        <span class="comment">// Dispatch to touch targets.</span></div><div class="line">        <span class="comment">// 经过down事件分发结束，所有子 view 都没消费该事件</span></div><div class="line">        <span class="keyword">if</span> (mFirstTouchTarget == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// No touch targets so treat this as an ordinary view.</span></div><div class="line">            <span class="comment">// 事件直接由 viewgroup 自己消费</span></div><div class="line">            <span class="comment">// child = null；dispatchTransformedTouchEvent</span></div><div class="line">            <span class="comment">// 会直接去调用 view 的 disPatchTouchEvent</span></div><div class="line">            handled = dispatchTransformedTouchEvent(ev, canceled, <span class="keyword">null</span>,</div><div class="line">                    TouchTarget.ALL_POINTER_IDS);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// Dispatch to touch targets, excluding the new touch target if we already</span></div><div class="line">            <span class="comment">// dispatched to it.  Cancel touch targets if necessary.</span></div><div class="line">            <span class="comment">// mFirstTouchTarget != null说明已经有 view 拿到了 down 事件，后续事件也交给它</span></div><div class="line">            TouchTarget predecessor = <span class="keyword">null</span>;</div><div class="line">            TouchTarget target = mFirstTouchTarget;</div><div class="line">            <span class="keyword">while</span> (target != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">final</span> TouchTarget next = target.next;</div><div class="line">                <span class="keyword">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</div><div class="line">                    handled = <span class="keyword">true</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">final</span> <span class="keyword">boolean</span> cancelChild = resetCancelNextUpFlag(target.child)</div><div class="line">                            || intercepted;</div><div class="line">                    <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</div><div class="line">                            target.child, target.pointerIdBits)) &#123;</div><div class="line">                        <span class="comment">// 该TouchTarget已经在前面的情况中被分发处理了，避免重复处理</span></div><div class="line">                        handled = <span class="keyword">true</span>;</div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">// 如果发送了取消事件，则移除分发记录（链表移动操作）</span></div><div class="line">                    <span class="keyword">if</span> (cancelChild) &#123;</div><div class="line">                        <span class="keyword">if</span> (predecessor == <span class="keyword">null</span>) &#123;</div><div class="line">                            mFirstTouchTarget = next;</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            predecessor.next = next;</div><div class="line">                        &#125;</div><div class="line">                        target.recycle();</div><div class="line">                        target = next;</div><div class="line">                        <span class="keyword">continue</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                predecessor = target;</div><div class="line">                target = next;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Update list of touch targets for pointer up or cancel, if needed.</span></div><div class="line">        <span class="comment">// 如果为up事件或者hover_move事件（一系列触摸事件结束），清除记录的信息</span></div><div class="line">        <span class="keyword">if</span> (canceled</div><div class="line">                || actionMasked == MotionEvent.ACTION_UP</div><div class="line">                || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</div><div class="line">            resetTouchState();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123;</div><div class="line">            <span class="comment">// 清除保存触摸信息</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex();</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> idBitsToRemove = <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex);</div><div class="line">            removePointersFromTouchTargets(idBitsToRemove);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!handled &amp;&amp; mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</div><div class="line">        mInputEventConsistencyVerifier.onUnhandledEvent(ev, <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 返回事件被处理的结果</span></div><div class="line">    <span class="keyword">return</span> handled;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ViewGroup-onInterceptTouchEvent"><a href="#ViewGroup-onInterceptTouchEvent" class="headerlink" title="ViewGroup # onInterceptTouchEvent"></a>ViewGroup # onInterceptTouchEvent</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * Implement this method to intercept all touch screen motion events.  This</div><div class="line">     * allows you to watch events as they are dispatched to your children, and</div><div class="line">     * take ownership of the current gesture at any point.</div><div class="line">     *</div><div class="line">     * &lt;p&gt;Using this function takes some care, as it has a fairly complicated</div><div class="line">     * interaction with &#123;<span class="doctag">@link</span> View#onTouchEvent(MotionEvent)</div><div class="line">     * View.onTouchEvent(MotionEvent)&#125;, and using it requires implementing</div><div class="line">     * that method as well as this one in the correct way.  Events will be</div><div class="line">     * received in the following order:</div><div class="line">     *</div><div class="line">     * &lt;ol&gt;</div><div class="line">     * &lt;li&gt; You will receive the down event here.</div><div class="line">     * &lt;li&gt; The down event will be handled either by a child of this view</div><div class="line">     * group, or given to your own onTouchEvent() method to handle; this means</div><div class="line">     * you should implement onTouchEvent() to return true, so you will</div><div class="line">     * continue to see the rest of the gesture (instead of looking for</div><div class="line">     * a parent view to handle it).  Also, by returning true from</div><div class="line">     * onTouchEvent(), you will not receive any following</div><div class="line">     * events in onInterceptTouchEvent() and all touch processing must</div><div class="line">     * happen in onTouchEvent() like normal.</div><div class="line">     * &lt;li&gt; For as long as you return false from this function, each following</div><div class="line">     * event (up to and including the final up) will be delivered first here</div><div class="line">     * and then to the target's onTouchEvent().</div><div class="line">     * &lt;li&gt; If you return true from here, you will not receive any</div><div class="line">     * following events: the target view will receive the same event but</div><div class="line">     * with the action &#123;<span class="doctag">@link</span> MotionEvent#ACTION_CANCEL&#125;, and all further</div><div class="line">     * events will be delivered to your onTouchEvent() method and no longer</div><div class="line">     * appear here.</div><div class="line">     * &lt;/ol&gt;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> ev The motion event being dispatched down the hierarchy.</div><div class="line">     * <span class="doctag">@return</span> Return true to steal motion events from the children and have</div><div class="line">     * them dispatched to this ViewGroup through onTouchEvent().</div><div class="line">     * The current target will receive an ACTION_CANCEL event, and no further</div><div class="line">     * messages will be delivered here.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">      	<span class="comment">// 在这里对事件进行判断是否需要拦截事件，如果事件需要被拦截，就会阻止事件继续下发</span></div><div class="line">        <span class="keyword">if</span> (ev.isFromSource(InputDevice.SOURCE_MOUSE)</div><div class="line">                &amp;&amp; ev.getAction() == MotionEvent.ACTION_DOWN</div><div class="line">                &amp;&amp; ev.isButtonPressed(MotionEvent.BUTTON_PRIMARY)</div><div class="line">                &amp;&amp; isOnScrollbarThumb(ev.getX(), ev.getY())) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="View-dispatchTouchEvent"><a href="#View-dispatchTouchEvent" class="headerlink" title="View # dispatchTouchEvent"></a>View # dispatchTouchEvent</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * Pass the touch screen motion event down to the target view, or this</div><div class="line">     * view if it is the target.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> event The motion event to be dispatched.</div><div class="line">     * <span class="doctag">@return</span> True if the event was handled by the view, false otherwise.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="comment">// If the event should be handled by accessibility focus first.</span></div><div class="line">      	<span class="comment">// 辅助功能事件情况</span></div><div class="line">        <span class="keyword">if</span> (event.isTargetAccessibilityFocus()) &#123;</div><div class="line">            <span class="comment">// We don't have focus or no virtual descendant has it, do not handle the event.</span></div><div class="line">            <span class="keyword">if</span> (!isAccessibilityFocusedViewOrHost()) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// We have focus and got the event, then use normal event dispatch.</span></div><div class="line">            event.setTargetAccessibilityFocus(<span class="keyword">false</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">      	<span class="comment">// 一致性检验，检查事件是否被改变</span></div><div class="line">        <span class="keyword">if</span> (mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</div><div class="line">            mInputEventConsistencyVerifier.onTouchEvent(event, <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = event.getActionMasked();</div><div class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</div><div class="line">            <span class="comment">// Defensive cleanup for new gesture</span></div><div class="line">          	<span class="comment">// 停止滚动（如果存在）</span></div><div class="line">            stopNestedScroll();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (onFilterTouchEventForSecurity(event)) &#123;</div><div class="line">            <span class="keyword">if</span> ((mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; handleScrollBarDragging(event)) &#123;</div><div class="line">                result = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//noinspection SimplifiableIfStatement</span></div><div class="line">          	<span class="comment">// 如果注册了 onTouchListener 监听，并且监听 回调方法中 onTouch() 返回 true 时，该</span></div><div class="line">          	<span class="comment">// 事件被消费，此时不会再执行 onTouchEvent(event)，注意：onClickListener() 会在 </span></div><div class="line">          	<span class="comment">// onTouchEvent(event) 中调用，所以如果 onTouch() 返回 true 时 click 事件就不会接收到</span></div><div class="line">            ListenerInfo li = mListenerInfo;</div><div class="line">            <span class="keyword">if</span> (li != <span class="keyword">null</span> &amp;&amp; li.mOnTouchListener != <span class="keyword">null</span></div><div class="line">                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED</div><div class="line">                    &amp;&amp; li.mOnTouchListener.onTouch(<span class="keyword">this</span>, event)) &#123;</div><div class="line">                result = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">          	<span class="comment">// 如果事件被消费就不会再执行 onTouchEvent(event)</span></div><div class="line">            <span class="keyword">if</span> (!result &amp;&amp; onTouchEvent(event)) &#123;</div><div class="line">                result = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">      	<span class="comment">// 一致性检验，检查事件是否被改变</span></div><div class="line">        <span class="keyword">if</span> (!result &amp;&amp; mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</div><div class="line">            mInputEventConsistencyVerifier.onUnhandledEvent(event, <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Clean up after nested scrolls if this is the end of a gesture;</span></div><div class="line">        <span class="comment">// also cancel it if we tried an ACTION_DOWN but we didn't want the rest</span></div><div class="line">        <span class="comment">// of the gesture.</span></div><div class="line">      	<span class="comment">// 如果是up事件（系列触摸动作的终点），或者是cancel事件，或者是初始事件并且我们没对它进行处理					// （回忆前面的内容，如果没有处理down事件，那么也不会收到后面的事件），就停止滚动状态</span></div><div class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_UP ||</div><div class="line">                actionMasked == MotionEvent.ACTION_CANCEL ||</div><div class="line">                (actionMasked == MotionEvent.ACTION_DOWN &amp;&amp; !result)) &#123;</div><div class="line">            stopNestedScroll();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="View-onTouchEvent"><a href="#View-onTouchEvent" class="headerlink" title="View # onTouchEvent()"></a>View # onTouchEvent()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * Implement this method to handle touch screen motion events.</div><div class="line">     * &lt;p&gt;</div><div class="line">     * If this method is used to detect click actions, it is recommended that</div><div class="line">     * the actions be performed by implementing and calling</div><div class="line">     * &#123;<span class="doctag">@link</span> #performClick()&#125;. This will ensure consistent system behavior,</div><div class="line">     * including:</div><div class="line">     * &lt;ul&gt;</div><div class="line">     * &lt;li&gt;obeying click sound preferences</div><div class="line">     * &lt;li&gt;dispatching OnClickListener calls</div><div class="line">     * &lt;li&gt;handling &#123;<span class="doctag">@link</span> AccessibilityNodeInfo#ACTION_CLICK ACTION_CLICK&#125; when</div><div class="line">     * accessibility features are enabled</div><div class="line">     * &lt;/ul&gt;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> event The motion event.</div><div class="line">     * <span class="doctag">@return</span> True if the event was handled, false otherwise.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> x = event.getX();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> y = event.getY();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> viewFlags = mViewFlags;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> action = event.getAction();</div><div class="line"></div><div class="line">      	<span class="comment">// 如果该view被禁用，但是被设置为clickable或longClickable或contextClickable，仍然消耗该事件</span></div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> clickable = ((viewFlags &amp; CLICKABLE) == CLICKABLE</div><div class="line">                || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)</div><div class="line">                || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123;</div><div class="line">          	<span class="comment">// 如果view被禁用且按下状态为true，取消接下状态</span></div><div class="line">            <span class="keyword">if</span> (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != <span class="number">0</span>) &#123;</div><div class="line">                setPressed(<span class="keyword">false</span>);</div><div class="line">            &#125;</div><div class="line">            mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</div><div class="line">            <span class="comment">// A disabled view that is clickable still consumes the touch</span></div><div class="line">            <span class="comment">// events, it just doesn't respond to them.</span></div><div class="line">            <span class="keyword">return</span> clickable;</div><div class="line">        &#125;</div><div class="line">      	<span class="comment">// 如果为该view设置了触摸事件代理，则转发到代理处理触摸事件</span></div><div class="line">        <span class="keyword">if</span> (mTouchDelegate != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (mTouchDelegate.onTouchEvent(event)) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">      	<span class="comment">// 处理了view被禁用和设置了触摸事件代理的情况。</span></div><div class="line">        <span class="keyword">if</span> (clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP) &#123;</div><div class="line">            <span class="keyword">switch</span> (action) &#123;</div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                    mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</div><div class="line">                    <span class="keyword">if</span> ((viewFlags &amp; TOOLTIP) == TOOLTIP) &#123;</div><div class="line">                        handleTooltipUp();</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (!clickable) &#123;</div><div class="line">                        removeTapCallback();</div><div class="line">                        removeLongPressCallback();</div><div class="line">                        mInContextButtonPress = <span class="keyword">false</span>;</div><div class="line">                        mHasPerformedLongPress = <span class="keyword">false</span>;</div><div class="line">                        mIgnoreNextUpEvent = <span class="keyword">false</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">boolean</span> prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != <span class="number">0</span>;</div><div class="line">                    <span class="keyword">if</span> ((mPrivateFlags &amp; PFLAG_PRESSED) != <span class="number">0</span> || prepressed) &#123;</div><div class="line">                        <span class="comment">// take focus if we don't have it already and we should in</span></div><div class="line">                        <span class="comment">// touch mode.</span></div><div class="line">                      	<span class="comment">// 如果有prepressed或pressed标志</span></div><div class="line">                        <span class="keyword">boolean</span> focusTaken = <span class="keyword">false</span>;</div><div class="line">                        <span class="keyword">if</span> (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123;</div><div class="line">                          	<span class="comment">// 可以获得焦点但没有获得</span></div><div class="line">        										<span class="comment">// 请求获取焦点</span></div><div class="line">                            focusTaken = requestFocus();</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="keyword">if</span> (prepressed) &#123;</div><div class="line">                            <span class="comment">// The button is being released before we actually</span></div><div class="line">                            <span class="comment">// showed it as pressed.  Make it show the pressed</span></div><div class="line">                            <span class="comment">// state now (before scheduling the click) to ensure</span></div><div class="line">                            <span class="comment">// the user sees it.</span></div><div class="line">                          	<span class="comment">// prepressed状态表示滚动容器中的点击检测还没有被消息队列执行，</span></div><div class="line">                          	<span class="comment">// 这个时候如果抬起手指说明是一个点击事件，调用setPressed显示反馈</span></div><div class="line">                            setPressed(<span class="keyword">true</span>, x, y);</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="keyword">if</span> (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) &#123;</div><div class="line">                            <span class="comment">// This is a tap, so remove the longpress check</span></div><div class="line">                          	<span class="comment">// 没有到达执行长按触发消息的时间就抬起了手指，</span></div><div class="line">                          	<span class="comment">// 说明这是一个单击事件，移除长按触发消息</span></div><div class="line">                            removeLongPressCallback();</div><div class="line"></div><div class="line">                            <span class="comment">// Only perform take click actions if we were in the pressed state</span></div><div class="line">                          	<span class="comment">// 当当前view没有获取焦点时才能触发点击事件，</span></div><div class="line">                          	<span class="comment">// 说明一个可以获取焦点的view是无法触发点击事件的</span></div><div class="line">                            <span class="keyword">if</span> (!focusTaken) &#123;</div><div class="line">                                <span class="comment">// Use a Runnable and post this rather than calling</span></div><div class="line">                                <span class="comment">// performClick directly. This lets other visual state</span></div><div class="line">                                <span class="comment">// of the view update before click actions start.</span></div><div class="line">                                <span class="keyword">if</span> (mPerformClick == <span class="keyword">null</span>) &#123;</div><div class="line">                                    mPerformClick = <span class="keyword">new</span> PerformClick();</div><div class="line">                                &#125;</div><div class="line">                              	<span class="comment">// 使用post来将performClick动作放入队列中执行来</span></div><div class="line">                              	<span class="comment">// 保证其他view视觉上的变化可以在点击事件被触发之前被看到</span></div><div class="line">                                <span class="keyword">if</span> (!post(mPerformClick)) &#123;</div><div class="line">                                    performClickInternal();</div><div class="line">                                &#125;</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                      	<span class="comment">// UnsetPressedState为Runnable消息，用于取消view的prepressed或pressed状态</span></div><div class="line">                        <span class="keyword">if</span> (mUnsetPressedState == <span class="keyword">null</span>) &#123;</div><div class="line">                            mUnsetPressedState = <span class="keyword">new</span> UnsetPressedState();</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="keyword">if</span> (prepressed) &#123;</div><div class="line">                          	<span class="comment">// 取消prepressed状态</span></div><div class="line">                            postDelayed(mUnsetPressedState,</div><div class="line">                                    ViewConfiguration.getPressedStateDuration());</div><div class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!post(mUnsetPressedState)) &#123;</div><div class="line">                            <span class="comment">// If the post failed, unpress right now</span></div><div class="line">                          	<span class="comment">// 取消pressed状态</span></div><div class="line">                            mUnsetPressedState.run();</div><div class="line">                        &#125;</div><div class="line">				</div><div class="line">                      	<span class="comment">// 清除单击检测消息</span></div><div class="line">                        removeTapCallback();</div><div class="line">                    &#125;</div><div class="line">                    mIgnoreNextUpEvent = <span class="keyword">false</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                    <span class="keyword">if</span> (event.getSource() == InputDevice.SOURCE_TOUCHSCREEN) &#123;</div><div class="line">                        mPrivateFlags3 |= PFLAG3_FINGER_DOWN;</div><div class="line">                    &#125;</div><div class="line">                    mHasPerformedLongPress = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (!clickable) &#123;</div><div class="line">                        checkForLongClick(<span class="number">0</span>, x, y);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                		<span class="comment">// 检查Button点击事件的特殊情况</span></div><div class="line">                		<span class="comment">// 只是处理了事件来源是鼠标的特殊情况。</span></div><div class="line">                    <span class="keyword">if</span> (performButtonActionOnTouchDown(event)) &#123;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="comment">// Walk up the hierarchy to determine if we're inside a scrolling container.</span></div><div class="line">                		<span class="comment">// 向上遍历view以检查是否处在一个可滚动的容器中</span></div><div class="line">                    <span class="keyword">boolean</span> isInScrollingContainer = isInScrollingContainer();</div><div class="line"></div><div class="line">                    <span class="comment">// For views inside a scrolling container, delay the pressed feedback for</span></div><div class="line">                    <span class="comment">// a short period in case this is a scroll.</span></div><div class="line">                		<span class="comment">// 如果是在滚动容器中，稍延迟触摸反馈来应对这是一个滚动操作的情况</span></div><div class="line">                    <span class="keyword">if</span> (isInScrollingContainer) &#123;</div><div class="line">                        mPrivateFlags |= PFLAG_PREPRESSED;</div><div class="line">                        <span class="keyword">if</span> (mPendingCheckForTap == <span class="keyword">null</span>) &#123;</div><div class="line">                          	<span class="comment">// 新建一个对象用于检测单击事件</span></div><div class="line">                          	<span class="comment">// 它是一个Runnable，用于延迟执行单击检测的任务：</span></div><div class="line">                            mPendingCheckForTap = <span class="keyword">new</span> CheckForTap();</div><div class="line">                        &#125;</div><div class="line">                        mPendingCheckForTap.x = event.getX();</div><div class="line">                        mPendingCheckForTap.y = event.getY();</div><div class="line">                      	<span class="comment">// 利用消息队列来延迟发送检测单击事件的方法，</span></div><div class="line">                      	<span class="comment">// 延迟时间为getTapTimeout设置的超时</span></div><div class="line">                        postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="comment">// Not inside a scrolling container, so show the feedback right away</span></div><div class="line">                      	<span class="comment">// 没有在滚动容器中，马上显示触摸反馈，并且开始检查长按事件</span></div><div class="line">                        setPressed(<span class="keyword">true</span>, x, y);</div><div class="line">                        checkForLongClick(<span class="number">0</span>, x, y);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</div><div class="line">                    <span class="keyword">if</span> (clickable) &#123;</div><div class="line">                        setPressed(<span class="keyword">false</span>);</div><div class="line">                    &#125;</div><div class="line">                    removeTapCallback();</div><div class="line">                    removeLongPressCallback();</div><div class="line">                    mInContextButtonPress = <span class="keyword">false</span>;</div><div class="line">                    mHasPerformedLongPress = <span class="keyword">false</span>;</div><div class="line">                    mIgnoreNextUpEvent = <span class="keyword">false</span>;</div><div class="line">                    mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                    <span class="keyword">if</span> (clickable) &#123;</div><div class="line">                      	<span class="comment">// 通知可能存在的子View或drawable触摸点发生了移动。</span></div><div class="line">                        drawableHotspotChanged(x, y);</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="comment">// Be lenient about moving outside of buttons</span></div><div class="line">                		<span class="comment">// 确定触摸点在范围内</span></div><div class="line">                    <span class="keyword">if</span> (!pointInView(x, y, mTouchSlop)) &#123;</div><div class="line">                        <span class="comment">// Outside button</span></div><div class="line">                        <span class="comment">// Remove any future long press/tap checks</span></div><div class="line">                      	<span class="comment">// 如果移出了这个范围，首先第4行调用removeTapCall()：</span></div><div class="line">                        removeTapCallback();</div><div class="line">                        removeLongPressCallback();</div><div class="line">                      	<span class="comment">// 如果pressed标志位为1，那么就取消消息队列中长按触发消息，</span></div><div class="line">                      	<span class="comment">// 同时去除pressed标志位。</span></div><div class="line">                        <span class="keyword">if</span> ((mPrivateFlags &amp; PFLAG_PRESSED) != <span class="number">0</span>) &#123;</div><div class="line">                            setPressed(<span class="keyword">false</span>);</div><div class="line">                        &#125;</div><div class="line">                        mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;<span class="comment">// 总结一下，只要触摸点移动出了当前view，那么所有的点击、长按事件都不会触发，</span></div><div class="line">		 <span class="comment">// 但是只要移动还在view+slot范围内，那么点击长按事件还是会被触发的。</span></div></pre></td></tr></table></figure>
<h3 id="冲突案例："><a href="#冲突案例：" class="headerlink" title="冲突案例："></a>冲突案例：</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://mp.weixin.qq.com/s?__biz=MzI2MzU0MTgzNw==&mid=100000011&idx=1&sn=6abf17b44b49de680c76ec808719202f&chksm=6abb04295dcc8d3f88b62e54c44b02d5836c85c7a2a760ce999834579a5923d0d5b14c5ecf75&scene=18#rd/2018/03/16/手把手科学上网教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LayneCui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LayneCui's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/16/手把手科学上网教程/" itemprop="url">手把手科学上网教程</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-16T14:13:05+08:00">
                2018-03-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<blockquote>
<p>很多朋友问我科学上网的方法，出个教程，只针对 Windows 系统</p>
</blockquote>
<p>我个人使用的是 ShadowSocks 已经用过几年，一直还挺稳定的。下面这个教程就对 SS 来发一下说明</p>
<h2 id="下载-SS-客户端"><a href="#下载-SS-客户端" class="headerlink" title="下载 SS 客户端"></a>下载 SS 客户端</h2><p>因为 SS 官网需要翻墙才能进入，所以我将最新安装包存到了云盘，不保证以后更新哦，有需要帮助的，公众号私信或者微信联系。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://mp.weixin.qq.com/s?__biz=MzI2MzU0MTgzNw==&mid=100000011&idx=1&sn=6abf17b44b49de680c76ec808719202f&chksm=6abb04295dcc8d3f88b62e54c44b02d5836c85c7a2a760ce999834579a5923d0d5b14c5ecf75&scene=18#rd/2017/05/09/记Hexo个人博客搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LayneCui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LayneCui's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/09/记Hexo个人博客搭建/" itemprop="url">记Hexo个人博客搭建</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-09T09:51:33+08:00">
                2017-05-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<blockquote>
<p>本人环境为 macOS，Windows 除了软件安装方式和命令行有些区别，其他基本一样</p>
</blockquote>
<p>先附上效果图如下：</p>
<p><img src="http://opoe327y9.bkt.clouddn.com/1386980-679e75b3f086bded.jpg" alt=""></p>
<h2 id="适合的人群"><a href="#适合的人群" class="headerlink" title="适合的人群"></a>适合的人群</h2><ul>
<li>喜欢写 Blog 的人</li>
<li>有一定编程基础</li>
<li>爱折腾的人</li>
<li>熟练使用版本控制 Git</li>
<li>了解 Github 的人</li>
<li>熟悉 MarkDown 基本语法的人</li>
</ul>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="安装-Git"><a href="#安装-Git" class="headerlink" title="安装 Git"></a>安装 Git</h3><ul>
<li>mac : <a href="https://sourceforge.net/projects/git-osx-installer/" target="_blank" rel="external">https://sourceforge.net/projects/git-osx-installer/</a></li>
<li>Windows : <a href="https://git-for-windows.github.io" target="_blank" rel="external">https://git-for-windows.github.io</a></li>
<li>Linux : apt-get install git</li>
</ul>
<h3 id="安装-NOde-js"><a href="#安装-NOde-js" class="headerlink" title="安装 NOde.js"></a>安装 NOde.js</h3><p>前往<a href="https://nodejs.org/en/" target="_blank" rel="external">官网地址</a>，根据教程安装即可。</p>
<h3 id="安装-hexo"><a href="#安装-hexo" class="headerlink" title="安装 hexo"></a>安装 hexo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo npm install hexo-cli -g</div></pre></td></tr></table></figure>
<h2 id="使用-hexo"><a href="#使用-hexo" class="headerlink" title="使用 hexo"></a>使用 hexo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"># 创建hexo文件夹</div><div class="line">$ mkdir hexo</div><div class="line"></div><div class="line"># 进入hexo文件夹</div><div class="line">$ cd hexo</div><div class="line"></div><div class="line"># 初始化hexo</div><div class="line">$ hexo init</div><div class="line"></div><div class="line"># 安装依赖包</div><div class="line">$ npm install</div><div class="line"></div><div class="line"># 本地查看</div><div class="line"># 先运行下面的命令，再在浏览器输入localhost:4000即可</div><div class="line">$ hexo server</div><div class="line"></div><div class="line"># 问题：执行hexo server提示找不到该指令</div><div class="line"># 解决办法：在Hexo 3.0 后server被单独出来了，需要安装server，安装的命令如下：</div><div class="line">$ npm install hexo -server --save</div></pre></td></tr></table></figure>
<h3 id="添加主题"><a href="#添加主题" class="headerlink" title="添加主题"></a>添加主题</h3><p>为了使博客不太难看，我们需要安装一个主题，切换至刚刚生成的Hexo 目录，安装主题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ cd username.github.io</div><div class="line">$ git clone https://github.com/litten/hexo-theme-yilia</div></pre></td></tr></table></figure>
<p>这里选了一个和我一样的主题，Hexo 有<a href="https://hexo.io/themes/" target="_blank" rel="external">更多主题</a>供你选择，你还可以搜一搜<a href="https://www.zhihu.com/question/24422335" target="_blank" rel="external">知乎</a>里有各大神的推荐。</p>
<p>主题配置需要在 /_config.yml 修改键值对就好。记得保存，并且注意配置的键值之间一定要有空格，具体的配置说明需要看每个主题的详细说明。</p>
<h3 id="生成静态网站"><a href="#生成静态网站" class="headerlink" title="生成静态网站"></a>生成静态网站</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<h3 id="本地查看"><a href="#本地查看" class="headerlink" title="本地查看"></a>本地查看</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># 本地查看</div><div class="line"># 先运行下面的命令，再在浏览器输入localhost:4000即可</div><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<h3 id="hexo相关配置和使用说明"><a href="#hexo相关配置和使用说明" class="headerlink" title="hexo相关配置和使用说明"></a>hexo相关配置和使用说明</h3><ul>
<li>全局配置 _config.yml</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"># Hexo Configuration</div><div class="line"># Docs: http://hexo.io/docs/configuration.html</div><div class="line"># Source: https://github.com/hexojs/hexo/</div><div class="line"># Site #站点信息</div><div class="line">title:  #标题</div><div class="line">subtitle:  #副标题</div><div class="line">description:  #站点描述，给搜索引擎看的</div><div class="line">author:  #作者</div><div class="line">email:  #电子邮箱</div><div class="line">language: zh-CN #语言</div><div class="line"># URL #链接格式</div><div class="line">url:  #网址</div><div class="line">root: / #根目录</div><div class="line">permalink: :year/:month/:day/:title/ #文章的链接格式</div><div class="line">tag_dir: tags #标签目录</div><div class="line">archive_dir: archives #存档目录</div><div class="line">category_dir: categories #分类目录</div><div class="line">code_dir: downloads/code</div><div class="line">permalink_defaults:</div><div class="line"># Directory #目录</div><div class="line">source_dir: source #源文件目录</div><div class="line">public_dir: public #生成的网页文件目录</div><div class="line"># Writing #写作</div><div class="line">new_post_name: :title.md #新文章标题</div><div class="line">default_layout: post #默认的模板，包括 post、page、photo、draft（文章、页面、照片、草稿）</div><div class="line">titlecase: false #标题转换成大写</div><div class="line">external_link: true #在新选项卡中打开连接</div><div class="line">filename_case: 0</div><div class="line">render_drafts: false</div><div class="line">post_asset_folder: false</div><div class="line">relative_link: false</div><div class="line">highlight: #语法高亮</div><div class="line">  enable: true #是否启用</div><div class="line">  line_number: true #显示行号</div><div class="line">  tab_replace:</div><div class="line"># Category &amp; Tag #分类和标签</div><div class="line">default_category: uncategorized #默认分类</div><div class="line">category_map:</div><div class="line">tag_map:</div><div class="line"># Archives</div><div class="line">2: 开启分页</div><div class="line">1: 禁用分页</div><div class="line">0: 全部禁用</div><div class="line">archive: 2</div><div class="line">category: 2</div><div class="line">tag: 2</div><div class="line"># Server #本地服务器</div><div class="line">port: 4000 #端口号</div><div class="line">server_ip: localhost #IP 地址</div><div class="line">logger: false</div><div class="line">logger_format: dev</div><div class="line"># Date / Time format #日期时间格式</div><div class="line">date_format: YYYY-MM-DD #参考http://momentjs.com/docs/#/displaying/format/</div><div class="line">time_format: H:mm:ss</div><div class="line"># Pagination #分页</div><div class="line">per_page: 10 #每页文章数，设置成 0 禁用分页</div><div class="line">pagination_dir: page</div><div class="line"># Disqus #Disqus评论，替换为多说</div><div class="line">disqus_shortname:</div><div class="line"># Extensions #拓展插件</div><div class="line">theme: landscape-plus #主题</div><div class="line">exclude_generator:</div><div class="line">plugins: #插件，例如生成 RSS 和站点地图的</div><div class="line">- hexo-generator-feed</div><div class="line">- hexo-generator-sitemap</div><div class="line"># Deployment #部署，将 lmintlcx 改成用户名</div><div class="line">deploy:</div><div class="line">  type: git</div><div class="line">  repo: https://github.com/username/username.github.io.git    // 刚创建的Github仓库</div><div class="line">  branch: master</div></pre></td></tr></table></figure>
<ul>
<li>hexo命令行使用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">常用命令：</div><div class="line">hexo help #查看帮助</div><div class="line">hexo init #初始化一个目录</div><div class="line">hexo new &quot;postName&quot; #新建文章</div><div class="line">hexo new page &quot;pageName&quot; #新建页面</div><div class="line">hexo generate #生成网页，可以在 public 目录查看整个网站的文件</div><div class="line">hexo server #本地预览，&apos;Ctrl+C&apos;关闭</div><div class="line">hexo deploy #部署.deploy目录</div><div class="line">hexo clean #清除缓存，强烈建议每次执行命令前先清理缓存，每次部署前先删除 .deploy 文件夹</div><div class="line"></div><div class="line">简写：</div><div class="line">hexo n == hexo new</div><div class="line">hexo g == hexo generate</div><div class="line">hexo s == hexo server</div><div class="line">hexo d == hexo deploy</div></pre></td></tr></table></figure>
<h2 id="创建-github-博客"><a href="#创建-github-博客" class="headerlink" title="创建 github 博客"></a>创建 github 博客</h2><h3 id="注册账号"><a href="#注册账号" class="headerlink" title="注册账号"></a>注册账号</h3><p>地址：<a href="https://github.com/" target="_blank" rel="external">https://github.com/</a><br>输入账号、邮箱、密码,然后点击注册按钮.</p>
<p><img src="http://opoe327y9.bkt.clouddn.com/1386980-b1982323b5ad7ee7.jpg" alt=""></p>
<h3 id="创建页面仓库"><a href="#创建页面仓库" class="headerlink" title="创建页面仓库"></a>创建页面仓库</h3><p><img src="http://opoe327y9.bkt.clouddn.com/1386980-583a8ace62eeed34.jpg" alt=""><br><img src="http://opoe327y9.bkt.clouddn.com/1386980-65df6a296a484632.jpg" alt=""></p>
<p><code>注意</code><br>命名规则：你的github账号.github.io。</p>
<h3 id="查看-SSH"><a href="#查看-SSH" class="headerlink" title="查看 SSH"></a>查看 SSH</h3><p>Linux 与 mac 都是默认安装了 SSH ，而 Windows 系统安装了 GitBash 应该也是带了 SSH 的，大家可以在终端（win 下在 GitBash 里）输入 ssh 如果出现以下提示证明你本机已经安装了 SSH，否则请搜索自行安装下。<br><img src="http://opoe327y9.bkt.clouddn.com/1386980-4aeb041d6da2cfad.jpg" alt=""></p>
<h3 id="生成-SSH-密钥"><a href="#生成-SSH-密钥" class="headerlink" title="生成 SSH 密钥"></a>生成 SSH 密钥</h3><p>紧接着输入 ssh-keygen -t rsa ，什么意思呢？就是指定 rsa 算法生成密钥，接着三个回车键（不需要输入密码），然后就会生成两个文件 id_rsa 和 id_rsa.pub，而 id_rsa 是密钥，id_rsa.pub 就是公钥。这两个文件默认分别在如下目录里生成：Linus/mac 系统在 ~/.ssh 下，win 系统在/c/Documents and Settings/username/.ssh下，都是隐藏文件，相信你们有办法看到的。接下来要做的就是把 id_rsa.pub 的内容添加到 GitHub 上，这样本地的 id_rsa 密钥跟 GitHub 上的 id_rsa.pub 公钥进行配对，授权成功才可以提交代码。</p>
<h3 id="在-GitHub-上添加-SSH-密钥"><a href="#在-GitHub-上添加-SSH-密钥" class="headerlink" title="在 GitHub 上添加 SSH 密钥"></a>在 GitHub 上添加 SSH 密钥</h3><p>1.在 GitHub 上的设置页面，点击最左侧 SSH and GPG keys ：<br><img src="http://opoe327y9.bkt.clouddn.com/1386980-6426936c15615606.jpg" alt=""></p>
<p>2.然后点击右上角的 New SSH key 按钮 ：<br><img src="http://opoe327y9.bkt.clouddn.com/1386980-6c57953f3ef7e231.jpg" alt=""></p>
<p>3.在 Key 那栏把 id_rsa.pub 公钥文件里的内容复制粘贴进去就可以了（上述示例为了安全粘贴的公钥是无效的），Title 那栏不需要填写，点击 Add SSH key 按钮就 ok 了。</p>
<h2 id="hexo-编辑文章"><a href="#hexo-编辑文章" class="headerlink" title="hexo 编辑文章"></a>hexo 编辑文章</h2><p>新建文章<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo new 标题</div></pre></td></tr></table></figure></p>
<p>在 _posts 目录下会生成文件标题.md<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">title: Hello World</div><div class="line">date: 2015-07-30 07:56:29 #发表日期，一般不改动</div><div class="line">categories: hexo #文章文类</div><div class="line">tags: [hexo,github] #文章标签，多于一项时用这种格式</div><div class="line">---</div><div class="line">正文，使用Markdown语法书写</div></pre></td></tr></table></figure></p>
<p>编辑完后保存，hexo server 预览</p>
<h2 id="hexo-部署"><a href="#hexo-部署" class="headerlink" title="hexo 部署"></a>hexo 部署</h2><p>执行下列指令即可完成部署。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hexo generate</div><div class="line">hexo deploy</div></pre></td></tr></table></figure></p>
<p><code>hexo deploy问题：Deployer not found: git</code><br>执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install hexo-deployer-git --save</div></pre></td></tr></table></figure></p>
<p>重新deploy即可</p>
<p>以下提示说明部署成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[info] Deploy done: git</div></pre></td></tr></table></figure>
<p>好啦恭喜你能走到这一步，你的博客已经完成了，在浏览器中输入 <a href="http://username.github.io" target="_blank" rel="external">http://username.github.io</a> 就能够访问了。</p>
<h2 id="联系我"><a href="#联系我" class="headerlink" title="联系我"></a>联系我</h2><p>1.Android 技术公众号：<br><img src="http://opoe327y9.bkt.clouddn.com/17-5-9/94210561-file_1494316766889_e51d.jpg" alt=""></p>
<p>2.我的微信<br><img src="http://opoe327y9.bkt.clouddn.com/17-5-9/9325813-file_1494317128733_cd6e.png" alt=""></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="http://wuxiaolong.me/2015/07/31/build-blog-by-hexo/" target="_blank" rel="external">手把手教你建github技术博客by hexo</a><br><a href="http://www.jianshu.com/p/4eaddcbe4d12?utm_campaign=hugo&amp;utm_medium=reader_share&amp;utm_content=note" target="_blank" rel="external">5分钟 搭建免费个人博客</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">LayneCui</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/LayneCui" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://youtube.com/yourname" target="_blank" title="YouTube">
                      
                        <i class="fa fa-fw fa-youtube"></i>YouTube</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LayneCui</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  








  












  





  

  

  

  
  

  

  

  

</body>
</html>
